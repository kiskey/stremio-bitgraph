// prisma/schema.prisma
// Prisma Schema Definition for PostgreSQL Database
// Defines the database models and their relationships.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Model to store cached torrent information linked to TMDB episodes
model Torrent {
  id                      Int      @id @default(autoincrement())
  infohash                String   @unique // Unique infohash of the torrent
  tmdbId                  String   @map("tmdb_id") // TMDB series ID
  seasonNumber            Int      @map("season_number") // Season number
  episodeNumber           Int      @map("episode_number") // Episode number
  torrentName             String   @map("torrent_name") // Original torrent name from Bitmagnet
  parsedInfoJson          Json     @map("parsed_info_json") @db.JsonB // Stores structured output from parse-torrent-title
  realDebridTorrentId     String   @unique @map("real_debrid_torrent_id") // Real-Debrid's internal ID for the added torrent
  realDebridFileId        String   @map("real_debrid_file_id") // Real-Debrid's internal ID for the specific file
  realDebridLink          String   @map("real_debrid_link") // Final unrestricted streaming URL
  addedAt                 DateTime @default(now()) @map("added_at") // Timestamp when added
  lastCheckedAt           DateTime @default(now()) @map("last_checked_at") // Last time torrent status was checked/updated
  languagePreference      String?  @map("language_preference") // Preferred language (e.g., "en")
  seeders                 Int      // Number of seeders at time of discovery

  @@index([tmdbId, seasonNumber, episodeNumber]) // Index for quick lookups by episode
  @@index([infohash]) // Index for quick lookups by infohash
  @@index([realDebridTorrentId]) // Index for quick lookups by Real-Debrid torrent ID
  @@map("torrents") // Map model name to table name
}
